<!--
 * --------------------------------------------------------------
 * Author: Rafael Passos Domingues
 * Last Update: 2025 June 6
 * --------------------------------------------------------------
-->

<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MeetMotions</title>
  <style>
    :root {
      --primary-color: #2c5282;
      --secondary-color: #1a365d;
      --accent-color: #4299e1;
      --accent-light: #63b3ed;
      --accent-yellow: #fefcbf;
      --text-color: #2d3748;
      --text-muted: #718096;
      --bg-color: #f7fafc;
      --panel-bg: #ffffff;
      --card-bg: #edf2f7;
      --border-color: #e2e8f0;
      --success-color: #48bb78;
      --warning-color: #f6ad55;
      --danger-color: #f56565;
      --info-color: #4299e1;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --transition-speed: 0.3s;
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      --header-real-height: 115px; /* Approximate height of your header, adjust as needed */
    }

    [data-theme="dark"] {
      --primary-color: #4299e1; --secondary-color: #2b6cb0; --accent-color: #63b3ed;
      --accent-light: #90cdf4; --accent-yellow: #975a16; --text-color: #f7fafc;
      --text-muted: #a0aec0; --bg-color: #1a202c; --panel-bg: #2d3748;
      --card-bg: #4a5568; --border-color: #4a5568; --success-color: #68d391;
      --warning-color: #fbd38d; --danger-color: #fc8181; --info-color: #63b3ed;
      --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.2);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.3),0 2px 4px -1px rgba(0,0,0,0.2);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.3),0 4px 6px -2px rgba(0,0,0,0.2);
    }
    
    /* Estilos de corpo e HTML para data-attributes de acessibilidade */
    html[data-high-contrast="true"] body {
      --primary-color: #000; --secondary-color: #000; --accent-color: #000;
      --accent-light: #000; --text-color: #000; --text-muted: #000;
      --bg-color: #fff; --panel-bg: #fff; --card-bg: #fff; --border-color: #000;
      --shadow-sm: none; --shadow-md: none; --shadow-lg: none;
    }
    html[data-high-contrast="true"] body * { border-color: #000 !important; }
    html[data-high-contrast="true"] body button,
    html[data-high-contrast="true"] body .badge,
    html[data-high-contrast="true"] body .timeline-icon,
    html[data-high-contrast="true"] body .accessibility-btn, 
    html[data-high-contrast="true"] body .font-size-btn,    
    html[data-high-contrast="true"] body .theme-switch      
    {
      background: #000 !important; color: #fff !important; border: 2px solid #000 !important;
    }
    html[data-high-contrast="true"] body .question-card.active,
    html[data-high-contrast="true"] body .nav-button.active {
      background: #000 !important; color: #fff !important; border: 2px solid #000 !important;
    }
     html[data-high-contrast="true"] body .nav-button:not(.active) { color: #000 !important; }
     html[data-high-contrast="true"] body header { background: #fff; color: #000; }
     html[data-high-contrast="true"] body header h1, html[data-high-contrast="true"] body header p { color: #000; }

    body[data-font-size="large"] { font-size: 1.1rem; }
    body[data-font-size="large"] :is(h1, h2, h3, .stat-card .value, .preview-question) { font-size: calc(1em * 1.15); }
    body[data-font-size="x-large"] { font-size: 1.25rem; }
    body[data-font-size="x-large"] :is(h1, h2, h3, .stat-card .value, .preview-question) { font-size: calc(1em * 1.2); }


    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-family);
      background-color: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      line-height: 1.6;
      transition: background-color var(--transition-speed), color var(--transition-speed);
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem;
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
      color: white;
      text-align: center;
      position: relative;
      box-shadow: var(--shadow-md);
      flex-shrink: 0;
    }

    header h1 { margin-bottom: 0.25rem; font-size: 1.6rem; }
    header p { font-size: 0.9rem; margin-bottom: 0.5rem; opacity: 0.9; }
    
    .header-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: absolute;
        top: 1rem;
        left: 1rem;
        right: 1rem;
        max-width: 100%; 
    }
    .header-controls .left-controls { display: flex; gap: 0.5rem; align-items: center;}
    .header-controls .accessibility-controls { margin-left: 1rem; } 


    .timer {
      background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 5px;
      font-size: 1rem; font-weight: bold;
    }
    .theme-switch {
      background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 5px;
      cursor: pointer; font-size: 1.2rem;
    }


    .container {
      display: grid;
      grid-template-columns: 260px 1fr; 
      gap: 1rem;
      padding: 1rem;
      margin: 0 auto;
      flex-grow: 1;
      overflow: hidden; 
      width: 100%;
    }

    #left-nav-panel {
      background: var(--panel-bg);
      border-radius: 10px;
      padding: 1rem;
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      height: calc(100vh - var(--header-real-height) - 2rem); 
      overflow: hidden;
    }

    #left-nav-panel .nav-header h2 {
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
      color: var(--primary-color);
      font-size: 1.3rem;
    }

    .nav-menu {
      flex-grow: 1;
      overflow-y: auto;
    }
    .nav-menu::-webkit-scrollbar { width: 6px; }
    .nav-menu::-webkit-scrollbar-track { background: var(--card-bg); border-radius: 3px; }
    .nav-menu::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 3px; }


    .nav-button {
      display: block; width: 100%;
      padding: 0.75rem 1rem; margin-bottom: 0.5rem;
      border-radius: 4.99px; border: 1px solid transparent;
      font-size: 0.95rem; background: transparent; color: var(--text-color);
      text-align: left; cursor: pointer;
      transition: all var(--transition-speed);
    }
    .nav-button:hover { background: var(--card-bg); border-color: var(--accent-color); }
    .nav-button.active {
      background: var(--accent-color); color: white;
      font-weight: bold; border-color: var(--accent-color);
    }
    
    #main-content-panel {
      border-radius: 10px;
      box-shadow: var(--shadow-md);
      display: flex; 
      flex-direction: column;
      height: calc(100vh - var(--header-real-height) - 2rem);
      overflow: hidden; 
      background: var(--panel-bg); 
    }

    .content-section {
      display: none; 
      flex-direction: column;
      flex-grow: 1; 
      overflow: hidden; 
    }
    .content-section.active { display: flex; }
    
    .panel-header-title { 
      border-bottom: 1px solid var(--border-color);
      padding: 1rem; 
      margin-bottom: 0; 
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--primary-color);
      font-size: 1.1rem; 
      flex-shrink: 0;
    }
    .panel-header-title h2 { 
        margin-bottom: 0;
        color: var(--primary-color);
        font-size: 1.4rem; 
    }

    .panel-content {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem; 
      padding-right: calc(1rem + 0.5rem); 
    }
    .panel-content::-webkit-scrollbar { width: 6px; }
    .panel-content::-webkit-scrollbar-track { background: var(--card-bg); border-radius: 3px; }
    .panel-content::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 3px; }

    .panel-footer {
      margin-top: auto; 
      border-top: 1px solid var(--border-color);
      padding: 1rem; 
      display: flex;
      justify-content: space-between; 
      flex-shrink: 0;
      gap: 0.5rem; 
    }
    .panel-footer button { width: auto; } 


    input, textarea, button, select {
      width: 100%; padding: 0.75rem; margin-bottom: 1rem;
      border-radius: 5px; border: 1px solid var(--border-color);
      font-size: 1rem; background: var(--card-bg); color: var(--text-color);
      transition: all var(--transition-speed);
    }
    input:focus, textarea:focus, select:focus {
      outline: none; box-shadow: 0 0 0 2px var(--accent-color);
      border-color: var(--accent-color);
    }
    button {
      cursor: pointer; font-weight: bold;
      background: var(--accent-color); color: white; border: none;
    }
    button:not(.nav-button):not(.accessibility-btn):not(.font-size-btn):not(.emotion-btn):not(.tab-btn) {
        transition: all var(--transition-speed);
    }
    button:not(.nav-button):not(.accessibility-btn):not(.font-size-btn):not(.emotion-btn):not(.tab-btn):hover {
      background: var(--accent-light); transform: translateY(-2px); box-shadow: var(--shadow-md);
    }
    button:not(.nav-button):not(.accessibility-btn):not(.font-size-btn):not(.emotion-btn):not(.tab-btn):active {
      transform: translateY(0);
    }
    button:focus { 
      outline: none; box-shadow: 0 0 0 3px rgba(66,153,225,0.5);
    }

    .btn-group { display: flex; gap: 0.5rem; }
    .btn-group button { flex: 1; }
    .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.9rem; margin-bottom: 0; } 
    .btn-success { background-color: var(--success-color); }
    .btn-warning { background-color: var(--warning-color); color: var(--text-color); }
    .btn-danger { background-color: var(--danger-color); }
    .btn-info { background-color: var(--info-color); }
    .btn-outline { background: transparent; border: 1px solid var(--accent-color); color: var(--accent-color); }
    .btn-outline:hover { background: var(--accent-color); color: white; }
    
    #perguntas-content .btn-group button { margin-bottom: 0; } 
    #perguntas-content .btn-group button.active {
        background-color: var(--secondary-color); 
        color: white;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }
     #perguntas-content .btn-group button:not(.active):hover {
        background-color: var(--accent-light);
     }


    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); }
    
    .question-card { 
      background: var(--card-bg); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;
      transition: all var(--transition-speed); border-left: 4px solid transparent;
    }
    .question-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
    .question-card.active { 
      border-left-color: var(--accent-color); background: var(--accent-yellow); color: var(--text-color);
    }
    .question-card h3 { margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
    .question-card .meta { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem; }
    .question-card .actions { display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 0.5rem; }
    .question-card .actions button { width: auto; } 


    .response-card {
      background: var(--card-bg); border-radius: 6px; padding: 0.75rem; margin-bottom: 0.75rem;
      animation: fadeIn 0.5s ease-in-out; border-left: 3px solid var(--info-color);
    }
    .response-card p, .response-card div:first-child { margin-bottom: 0.5rem; }
    .response-card .meta { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem; }


    .emotion-container { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0; }
    .emotion-btn {
      background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 20px;
      padding: 0.5rem 1rem; font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;
      cursor: pointer; transition: all var(--transition-speed); flex: 0 0 auto; margin-bottom: 0;
    }
    .emotion-btn:hover { background: var(--accent-yellow); transform: translateY(-2px); }
    .emotion-btn .count { background: var(--accent-color); color: white; border-radius: 10px; padding: 0.1rem 0.4rem; font-size: 0.8rem; }

    .navigation { display: flex; justify-content: space-between; margin-top: 1rem; }
    .navigation button { width: auto; }

    .badge {
      display: inline-block; padding: 0.25rem 0.5rem; border-radius: 20px;
      font-size: 0.8rem; font-weight: bold; margin-left: 0.5rem;
    }
    .badge-open { background-color: var(--info-color); color: white; }
    .badge-closed { background-color: var(--warning-color); color: var(--text-color); }
    .badge-active { background-color: var(--success-color); color: white; } 

    .preview-panel {
      background: var(--card-bg); border-radius: 10px; padding: 1rem; margin-top: 1rem;
      border: 1px dashed var(--border-color);
    }
    .preview-panel h3 { text-align: center; margin-bottom: 1rem; color: var(--text-muted); }
    .preview-content {
      background: var(--panel-bg); border-radius: 8px; padding: 1.5rem;
      text-align: center; box-shadow: var(--shadow-sm);
    }
    .preview-question { font-size: 1.5rem; margin-bottom: 1.5rem; line-height: 1.4; }
    .preview-responses { display: flex; flex-direction: column; gap: 1rem; max-width: 600px; margin: 0 auto; }
    .preview-response { background: var(--card-bg); border-radius: 8px; padding: 1rem; animation: slideIn 0.5s ease-out; text-align: left; }

    .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
    .stat-card { background: var(--card-bg); border-radius: 8px; padding: 1rem; text-align: center; transition: transform var(--transition-speed); }
    .stat-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
    .stat-card .value { font-size: 2rem; font-weight: bold; margin: 0.5rem 0; color: var(--primary-color); }
    .stat-card .label { font-size: 0.9rem; color: var(--text-muted); }

    .chart-container {
      width: 100%; height: 300px; margin: 1rem 0; background: var(--panel-bg);
      border-radius: 8px; padding: 1rem; box-shadow: var(--shadow-sm);
    }
    
    .wordcloud-container {
      width: 100%;
      min-height: 250px;
      margin: 1rem 0;
      background: var(--panel-bg);
      border-radius: 8px;
      padding: 1rem;
      box-shadow: var(--shadow-sm);
      position: relative;

      display: flex;
      align-items: center;
      justify-content: center;

      flex-wrap: wrap; /* Permite quebra de linha */
      box-sizing: border-box;
    }

    #wordcloud-canvas {
      width: 100%;
      height: 100%; /* For√ßa ocupar todo container */
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }

    .wordcloud-input {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      width: 100%;
      flex-wrap: wrap; /* Para quebra em telas pequenas */
      box-sizing: border-box;
    }

    .wordcloud-input input {
      flex: 1 1 200px; /* Cresce e encolhe com base m√≠nima */
      min-width: 0; /* Permite encolhimento */
      padding: 0.5rem;
      font-size: 1rem;
      box-sizing: border-box;
    }

    .wordcloud-input button {
      flex: 0 0 auto;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      white-space: nowrap;
      box-sizing: border-box;
    }

    /* Media queries para telas menores */
    @media (max-width: 600px) {
      .wordcloud-container {
        min-height: 200px;
        padding: 0.5rem;
      }

      .wordcloud-input {
        flex-direction: column;
        gap: 0.75rem;
      }

      .wordcloud-input input,
      .wordcloud-input button {
        width: 100%;
        flex: none;
      }
    }

    .timeline-container { 
      margin: 1rem 0; padding: 1rem; background: var(--panel-bg);
      border-radius: 8px; box-shadow: var(--shadow-sm);
    }
    .timeline-item { 
        display: flex;
        margin-bottom: 1rem;
        position: relative;
    }
    .timeline-item::before {
        content: '';
        position: absolute;
        left: calc(1.5rem - 1px); 
        top: 3rem; 
        bottom: -0.5rem; 
        width: 2px;
        background: var(--border-color);
        z-index: 0;
    }
    .timeline-item:last-child::before { display: none; }

    .timeline-icon {
        width: 3rem;
        height: 3rem;
        background: var(--accent-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        margin-right: 1rem;
        z-index: 1;
        flex-shrink: 0;
    }
    .timeline-content { 
        flex: 1;
        background: var(--card-bg);
        border-radius: 8px;
        padding: 1rem;
    }
    .timeline-time {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }
    
    .accessibility-controls { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;}
    .accessibility-btn {
      background: rgba(255,255,255,0.2); 
      border: 1px solid rgba(255,255,255,0.3); 
      color: white;
      border-radius: 5px;
      padding: 0.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 1rem; transition: all var(--transition-speed); flex: 0 0 auto; margin-bottom: 0; width: auto;
    }
    .accessibility-btn:hover { background: rgba(255,255,255,0.3); }
    .font-size-controls { display: flex; align-items: center; gap: 0.25rem; } 
    .font-size-btn {
      width: 2rem; height: 2rem; 
      display: flex; align-items: center; justify-content: center; border-radius: 5px;
      background: rgba(255,255,255,0.2); 
      border: 1px solid rgba(255,255,255,0.3); 
      color: white;
      cursor: pointer;
      font-weight: bold; transition: all var(--transition-speed); margin-bottom:0;
    }
    .font-size-btn:hover { background: rgba(255,255,255,0.3); }


    .tooltip { position: relative; display: inline-block; }
    .tooltip .tooltiptext {
      visibility: hidden; width: 200px; background-color: var(--text-color); color: var(--bg-color);
      text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 100;
      bottom: 125%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border-width: 0;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes pulse { 
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--accent-color-rgb, 66,153,225),0.4); } 
      70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(var(--accent-color-rgb, 66,153,225),0); } 
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--accent-color-rgb, 66,153,225),0); } 
    }
    .emotion-btn.pulse { animation: pulse 0.5s ease-out; }
    .hidden { display: none !important; }

    
    @media (max-width: 1100px) { 
        header { text-align: left; padding-bottom: 4rem;  }
        header h1 { margin-left: calc(1rem + 3em);  }
        header p { margin-left: calc(1rem + 3em); }
        .header-controls {
            position: static; 
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.5rem; 
        }
        .header-controls .left-controls { width: 100%; justify-content: space-between; }
        .header-controls .accessibility-controls { margin-left: 0; }
        .timer { 
            align-self: flex-end;
        }
    }


    @media (max-width: 992px) { 
      .container {
        grid-template-columns: 200px 1fr; 
      }
      #left-nav-panel .nav-header h2 { font-size: 1.1rem; }
      .nav-button { font-size: 0.9rem; padding: 0.6rem 0.8rem;}
    }

    @media (max-width: 768px) { 
      .container {
        grid-template-columns: 1fr; 
        padding: 0.5rem; gap: 0.5rem;
      }
      #left-nav-panel {
        height: auto; max-height: 35vh; 
        margin-bottom: 0.5rem;
      }
      #main-content-panel {
         height: auto; 
         min-height: 60vh; 
      }
      #left-nav-panel .nav-header { display: none; } 
      .nav-menu { display: flex; flex-wrap: wrap; gap: 0.25rem; }
      .nav-button { flex: 1 1 auto; text-align: center; font-size:0.85rem; padding: 0.5rem; }

      .btn-group { flex-direction: column; }
      .emotion-container { justify-content: center; }
      .stats-container { grid-template-columns: 1fr 1fr; }
      .chart-container, .wordcloud-container { height: 250px; }
      .panel-header-title { flex-direction: column; align-items: flex-start; gap: 0.5rem;}
    }

    @media (max-width: 576px) { 
      .nav-menu { 
          overflow-x: auto; flex-wrap: nowrap; padding-bottom: 0.5rem;
      }
      .nav-button { white-space: nowrap; flex: 0 0 auto; }
      .stats-container { grid-template-columns: 1fr; }
      .chart-container, .wordcloud-container { height: 200px; }
      .timeline-item { flex-direction: column; align-items: flex-start; } 
      .timeline-icon { margin-bottom: 0.5rem; margin-right: 0; }  
      .timeline-item::before { display: none; }   
      .preview-question { font-size: 1.2rem; }
      .timer { font-size: 0.9rem; padding: 0.3rem; }
      .theme-switch { font-size: 1rem; padding: 0.3rem; }
      header h1 { font-size: 1.3rem; margin-left: 0;}
      header p { display: none; } 
      .panel-header-title h2 { font-size: 1.2rem; }
      .header-controls .left-controls { flex-direction: column; align-items: flex-start; gap: 0.5rem;}
      .accessibility-btn, .font-size-btn { padding: 0.4rem; font-size: 0.9rem;}
      .font-size-btn { width: 1.8rem; height: 1.8rem;}
    }
  </style>
</head>
<body>
  <header>
    <div class="header-controls">
        <div class="left-controls">
            <div class="theme-switch" id="themeSwitch" role="button" aria-label="Alternar modo escuro" tabindex="0">
              üåì
            </div>
            <div class="accessibility-controls">
              <button id="highContrastToggle" class="accessibility-btn" aria-label="Alternar alto contraste">
                <span aria-hidden="true">üî≥</span>
              </button>
              <div class="font-size-controls">
                <button id="decreaseFontSize" class="font-size-btn" aria-label="Diminuir tamanho da fonte">A-</button>
                <button id="increaseFontSize" class="font-size-btn" aria-label="Aumentar tamanho da fonte">A+</button>
              </div>
            </div>
        </div>
        <div class="timer" id="eventTimer">00:00:00</div>
    </div>
    <h1>üé§ Meet Motions Tracking</h1>
    <p>Um copiloto para moderadores de eventos online</p>
  </header>

  <div class="container">
    <aside id="left-nav-panel">
      <div class="nav-header">
        <h2>Menu Principal</h2>
      </div>
      <nav class="nav-menu">
        <button class="nav-button active" data-target="perguntas-content" aria-label="Gerenciar Perguntas">Perguntas</button>
        <button class="nav-button" data-target="wordcloud-content" aria-label="Ver Nuvem de Palavras">Nuvem de Palavras</button>
        <button class="nav-button" data-target="emotions-content" aria-label="Registrar Emo√ß√µes">Emo√ß√µes</button>
        <button class="nav-button" data-target="stats-content" aria-label="Ver Estat√≠sticas">Estat√≠sticas</button>
        <button class="nav-button" data-target="visualizacao-content" aria-label="Ver Painel de Visualiza√ß√£o">Visualiza√ß√£o</button>
      </nav>
    </aside>

    <main id="main-content-panel">
      <section class="content-section active" id="perguntas-content">
        <div class="panel-header-title">
          <h2>Perguntas</h2>
        </div>
        <div class="panel-content">
          <div class="form-group">
            <label for="question-text">Nova Pergunta</label>
            <textarea id="question-text" placeholder="Digite sua pergunta ao p√∫blico..." aria-label="Digite sua pergunta ao p√∫blico"></textarea>
          </div>

          <div class="form-group">
            <label>Tipo de Pergunta</label>
            <div class="btn-group" role="radiogroup" aria-label="Selecione o tipo de pergunta">
              <button id="open-question" class="btn-sm btn-info active" role="radio" aria-checked="true">Aberta</button>
              <button id="closed-question" class="btn-sm" role="radio" aria-checked="false">Fechada</button>
            </div>
          </div>

          <div id="closed-options" class="form-group hidden">
            <label for="question-options">Op√ß√µes (uma por linha)</label>
            <textarea id="question-options" placeholder="Op√ß√£o 1&#10;Op√ß√£o 2&#10;Op√ß√£o 3" aria-label="Op√ß√µes para pergunta fechada, uma por linha"></textarea>
          </div>

          <button id="add-question" class="btn-success" aria-label="Adicionar Pergunta">Adicionar Pergunta</button>

          <h3 style="margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1.2rem; color: var(--primary-color);">Perguntas Criadas</h3>
          <div id="questions-list" aria-live="polite">
            <p>Nenhuma pergunta criada ainda.</p>
          </div>
        </div>
      </section>

      <section class="content-section" id="wordcloud-content">
        <div class="panel-header-title">
          <h2>Nuvem de Palavras</h2>
        </div>
        <div class="panel-content">
          <p>Adicione palavras-chave mencionadas durante o evento:</p>
          
          <div class="wordcloud-input">
            <input type="text" id="word-input" placeholder="Digite uma palavra..." aria-label="Digite uma palavra para adicionar √† nuvem">
            <button id="add-word" class="btn-info">Adicionar</button>
          </div>
          
          <div class="wordcloud-container">
            <canvas id="wordcloud-canvas" aria-label="Nuvem de palavras do evento"></canvas>
          </div>
        </div>
        <div class="panel-footer">
          <button id="clear-wordcloud" class="btn-sm btn-outline">Limpar Nuvem</button>
          <button id="export-wordcloud" class="btn-sm btn-info">Exportar PNG</button>
        </div>
      </section>

      <section class="content-section" id="emotions-content">
        <div class="panel-header-title">
          <h2>Registro de Emo√ß√µes</h2>
        </div>
        <div class="panel-content">
          <p>Clique nas emo√ß√µes para registrar rea√ß√µes do p√∫blico:</p>
          
          <div class="emotion-container" role="group" aria-label="Bot√µes de emo√ß√µes">
            <button class="emotion-btn" data-emotion="üòÄ" aria-label="Feliz">
              üòÄ <span class="count">0</span>
            </button>
            <button class="emotion-btn" data-emotion="üëç" aria-label="Positivo">
              üëç <span class="count">0</span>
            </button>
            <button class="emotion-btn" data-emotion="‚ù§Ô∏è" aria-label="Amor">
              ‚ù§Ô∏è <span class="count">0</span>
            </button>
            <button class="emotion-btn" data-emotion="üòÆ" aria-label="Surpresa">
              üòÆ <span class="count">0</span>
            </button>
            <button class="emotion-btn" data-emotion="ü§î" aria-label="Pensativo">
              ü§î <span class="count">0</span>
            </button>
            <button class="emotion-btn" data-emotion="üëè" aria-label="Aplausos">
              üëè <span class="count">0</span>
            </button>
            <button class="emotion-btn" data-emotion="üòÇ" aria-label="Risos">
              üòÇ <span class="count">0</span>
            </button>
            <button class="emotion-btn" data-emotion="üéâ" aria-label="Celebra√ß√£o">
              üéâ <span class="count">0</span>
            </button>
          </div>

          <h3 style="margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1.2rem; color: var(--primary-color);">Linha do Tempo Emocional</h3>
          <div id="emotion-timeline" aria-live="polite" class="timeline-container">
            <p>Nenhuma emo√ß√£o registrada ainda.</p>
          </div>
        </div>
        <div class="panel-footer">
          <button id="export-emotions" class="btn-sm btn-info">Exportar Emo√ß√µes (PNG)</button>
        </div>
      </section>

      <section class="content-section" id="stats-content">
        <div class="panel-header-title">
          <h2>Estat√≠sticas</h2>
        </div>
        <div class="panel-content">
          <div class="stats-container">
            <div class="stat-card">
              <div class="label">Perguntas</div>
              <div class="value" id="stats-questions">0</div>
            </div>
            <div class="stat-card">
              <div class="label">Respostas</div>
              <div class="value" id="stats-responses">0</div>
            </div>
            <div class="stat-card">
              <div class="label">Emo√ß√µes</div>
              <div class="value" id="stats-emotions">0</div>
            </div>
            <div class="stat-card">
              <div class="label">Palavras</div>
              <div class="value" id="stats-words">0</div>
            </div>
            <div class="stat-card">
              <div class="label">Tempo</div>
              <div class="value" id="stats-time">00:00</div>
            </div>
            <div class="stat-card">
              <div class="label">Engajamento</div>
              <div class="value" id="stats-engagement">0%</div>
            </div>
          </div>

          <div class="chart-container">
            <canvas id="emotions-chart" aria-label="Gr√°fico de emo√ß√µes"></canvas>
          </div>

          <div class="chart-container">
            <canvas id="timeline-chart" aria-label="Gr√°fico de linha do tempo de intera√ß√µes"></canvas>
          </div>
        </div>
        <div class="panel-footer">
          <button id="export-stats-csv" class="btn-sm btn-info">Exportar CSV</button>
          <button id="export-stats-png" class="btn-sm btn-info">Exportar Dashboard (PNG)</button>
        </div>
      </section>

      <section class="content-section" id="visualizacao-content">
        <div class="panel-header-title">
          <h2>Visualiza√ß√£o Atual <span id="active-question-badge" class="badge badge-active hidden">AO VIVO</span></h2>
        </div>
        <div class="panel-content">
          <div id="active-question-panel" class="hidden">
            <div class="form-group">
              <h3 id="active-question-title" style="margin-bottom: 0.5rem; font-size: 1.3rem; color: var(--primary-color);">Pergunta Ativa</h3>
              <div id="active-question-text" class="preview-question" style="background: var(--card-bg); padding: 1rem; border-radius: 8px; margin-bottom:1rem;"></div>
              
              <div id="active-question-options" class="hidden" style="margin-bottom:1rem; display: flex; flex-direction: column; gap: 0.5rem;">
                </div>
            </div>

            <div class="form-group">
              <label for="response-text">Adicionar Resposta</label>
              <div class="btn-group">
                <input type="text" id="response-text" placeholder="Digite uma resposta do p√∫blico..." aria-label="Digite uma resposta do p√∫blico" style="margin-bottom:0;">
                <button id="add-response" class="btn-sm btn-success" aria-label="Adicionar resposta" style="margin-bottom:0;">Adicionar</button>
              </div>
            </div>
            
            <h3 style="margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1.2rem; color: var(--primary-color);">Respostas Recebidas</h3>
            <div id="responses-list" aria-live="polite">
              <p>Nenhuma resposta recebida ainda.</p>
            </div>

            <div class="navigation">
              <button id="prev-question" class="btn-outline btn-sm" aria-label="Ir para pergunta anterior">‚Üê Pergunta Anterior</button>
              <button id="next-question" class="btn-outline btn-sm" aria-label="Ir para pr√≥xima pergunta">Pr√≥xima Pergunta ‚Üí</button>
            </div>
          </div>

          <div id="no-active-question" class="preview-panel">
            <h3>Nenhuma pergunta ativa no momento</h3>
            <p>Selecione uma pergunta no painel de controle para ativ√°-la ou crie uma nova na se√ß√£o "Perguntas".</p>
          </div>

          <div class="preview-panel" style="margin-top: 2rem;">
            <h3>Visualiza√ß√£o para o P√∫blico</h3>
            <div class="preview-content">
              <div id="public-question" class="preview-question">
                Aguardando o in√≠cio das perguntas...
              </div>
              <div id="public-responses" class="preview-responses">
                <p>Aguardando respostas...</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    /**
     * Modelo de dados da aplica√ß√£o
     */
    const eventData = {
      startTime: new Date(),
      questions: [],
      activeQuestionIndex: -1,
      emotions: [],
      words: [],
      totalResponses: 0,
      eventTimerInterval: null,
      eventElapsedTime: 0 // Em segundos
    };

    /**
     * Elementos DOM frequentemente acessados
     */
    const elements = {
      html: document.documentElement,
      body: document.body,
      themeSwitch: document.getElementById('themeSwitch'),
      highContrastToggle: document.getElementById('highContrastToggle'),
      increaseFontSizeBtn: document.getElementById('increaseFontSize'),
      decreaseFontSizeBtn: document.getElementById('decreaseFontSize'),
      eventTimerDisplay: document.getElementById('eventTimer'),
      
      // Perguntas
      questionText: document.getElementById('question-text'),
      openQuestionBtn: document.getElementById('open-question'),
      closedQuestionBtn: document.getElementById('closed-question'),
      questionOptions: document.getElementById('question-options'),
      closedOptions: document.getElementById('closed-options'),
      addQuestionBtn: document.getElementById('add-question'),
      questionsList: document.getElementById('questions-list'),
      
      // Pergunta Ativa e Respostas
      activeQuestionPanel: document.getElementById('active-question-panel'),
      noActiveQuestion: document.getElementById('no-active-question'),
      activeQuestionBadge: document.getElementById('active-question-badge'),
      activeQuestionTitle: document.getElementById('active-question-title'),
      activeQuestionText: document.getElementById('active-question-text'),
      activeQuestionOptions: document.getElementById('active-question-options'),
      responseText: document.getElementById('response-text'),
      addResponseBtn: document.getElementById('add-response'),
      responsesList: document.getElementById('responses-list'),
      prevQuestionBtn: document.getElementById('prev-question'),
      nextQuestionBtn: document.getElementById('next-question'),
      
      // Visualiza√ß√£o P√∫blica
      publicQuestion: document.getElementById('public-question'),
      publicResponses: document.getElementById('public-responses'),
      
      // Emo√ß√µes
      emotionBtns: document.querySelectorAll('.emotion-btn'),
      emotionTimeline: document.getElementById('emotion-timeline'),
      exportEmotionsBtn: document.getElementById('export-emotions'),
      
      // Nuvem de Palavras
      wordInput: document.getElementById('word-input'),
      addWordBtn: document.getElementById('add-word'),
      wordcloudCanvas: document.getElementById('wordcloud-canvas'),
      clearWordcloudBtn: document.getElementById('clear-wordcloud'),
      exportWordcloudBtn: document.getElementById('export-wordcloud'),
      
      // Estat√≠sticas
      statsQuestions: document.getElementById('stats-questions'),
      statsResponses: document.getElementById('stats-responses'),
      statsEmotions: document.getElementById('stats-emotions'),
      statsWords: document.getElementById('stats-words'),
      statsTime: document.getElementById('stats-time'),
      statsEngagement: document.getElementById('stats-engagement'),
      emotionsChartCanvas: document.getElementById('emotions-chart'),
      timelineChartCanvas: document.getElementById('timeline-chart'),
      exportStatsCsvBtn: document.getElementById('export-stats-csv'),
      exportStatsPngBtn: document.getElementById('export-stats-png')
    };

    // Vari√°veis para gr√°ficos
    let emotionsChartInstance = null;
    let timelineChartInstance = null; // Ainda n√£o inicializado no seu script

    /**
     * Inicializa o sistema de navega√ß√£o principal (substitui initTabs)
     */
    function initNavigation() {
      const navButtons = document.querySelectorAll('.nav-button');
      const contentSections = document.querySelectorAll('.content-section');

      navButtons.forEach(button => {
        if (button.classList.contains('active')) {
            button.setAttribute('aria-selected', 'true');
        } else {
            button.setAttribute('aria-selected', 'false');
        }

        button.addEventListener('click', () => {
          const targetId = button.dataset.target; 

          navButtons.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-selected', 'false');
          });
          
          contentSections.forEach(section => section.classList.remove('active'));
          
          button.classList.add('active');
          button.setAttribute('aria-selected', 'true');
          
          const targetSection = document.getElementById(targetId);
          if (targetSection) {
            targetSection.classList.add('active');
          }
          
          if (targetId === 'stats-content') {
            updateCharts(); 
          }
          if (targetId === 'wordcloud-content') {
            renderWordCloud();
          }
        });
      });
    }
    
    /**
     * Inicializa o toggle de tipo de pergunta
     */
    function initQuestionTypeToggle() {
      elements.openQuestionBtn.addEventListener('click', () => {
        elements.openQuestionBtn.classList.add('active');
        elements.openQuestionBtn.setAttribute('aria-checked', 'true');
        elements.closedQuestionBtn.classList.remove('active');
        elements.closedQuestionBtn.setAttribute('aria-checked', 'false');
        elements.closedOptions.classList.add('hidden');
      });
      
      elements.closedQuestionBtn.addEventListener('click', () => {
        elements.closedQuestionBtn.classList.add('active');
        elements.closedQuestionBtn.setAttribute('aria-checked', 'true');
        elements.openQuestionBtn.classList.remove('active');
        elements.openQuestionBtn.setAttribute('aria-checked', 'false');
        elements.closedOptions.classList.remove('hidden');
      });
    }

    /**
     * Inicializa controles de acessibilidade
     */
    function initAccessibilityControls() {
      elements.themeSwitch.addEventListener('click', toggleDarkMode);
      elements.themeSwitch.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          toggleDarkMode();
          e.preventDefault();
        }
      });
      elements.highContrastToggle.addEventListener('click', toggleHighContrast);
      elements.increaseFontSizeBtn.addEventListener('click', increaseFontSize);
      elements.decreaseFontSizeBtn.addEventListener('click', decreaseFontSize);
    }

    function toggleDarkMode() {
      const isDarkMode = elements.body.getAttribute('data-theme') === 'dark';
      elements.body.setAttribute('data-theme', isDarkMode ? 'light' : 'dark');
      elements.themeSwitch.innerHTML = isDarkMode ? 'üåì' : '‚òÄÔ∏è';
      elements.themeSwitch.setAttribute('aria-label', 
        isDarkMode ? 'Alternar para modo escuro' : 'Alternar para modo claro');
      updateCharts();
      renderWordCloud();
    }

    function toggleHighContrast() {
      const htmlElement = document.documentElement; // Refer√™ncia ao <html>
      const isHighContrast = htmlElement.getAttribute('data-high-contrast') === 'true';
      htmlElement.setAttribute('data-high-contrast', isHighContrast ? 'false' : 'true');
      updateCharts();
      renderWordCloud();
    }

    function increaseFontSize() {
      const currentSize = elements.body.getAttribute('data-font-size');
      if (!currentSize) {
        elements.body.setAttribute('data-font-size', 'large');
      } else if (currentSize === 'large') {
        elements.body.setAttribute('data-font-size', 'x-large');
      }
    }

    function decreaseFontSize() {
      const currentSize = elements.body.getAttribute('data-font-size');
      if (currentSize === 'x-large') {
        elements.body.setAttribute('data-font-size', 'large');
      } else if (currentSize === 'large') {
        elements.body.removeAttribute('data-font-size');
      }
    }

    /**
     * Inicializa todos os event listeners
     */
    function initEventListeners() {
      elements.addQuestionBtn.addEventListener('click', addQuestion);
      elements.addResponseBtn.addEventListener('click', addResponse);
      elements.prevQuestionBtn.addEventListener('click', navigateToPrevQuestion);
      elements.nextQuestionBtn.addEventListener('click', navigateToNextQuestion);
      
      elements.emotionBtns.forEach(btn => {
        btn.addEventListener('click', () => registerEmotion(btn.getAttribute('data-emotion')));
      });
      
      elements.addWordBtn.addEventListener('click', addWordToCloud);
      elements.clearWordcloudBtn.addEventListener('click', clearWordCloud);
      elements.exportWordcloudBtn.addEventListener('click', exportWordCloudAsPNG);
      
      elements.exportStatsCsvBtn.addEventListener('click', exportToCSV);
      elements.exportStatsPngBtn.addEventListener('click', exportDashboardAsPNG);
      elements.exportEmotionsBtn.addEventListener('click', exportEmotionsAsPNG);
      
      elements.responseText.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addResponse();
      });
      elements.wordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addWordToCloud();
      });
    }

    function addQuestion() {
      const questionText = elements.questionText.value.trim();
      if (!questionText) {
        alert('Por favor, digite uma pergunta.');
        return;
      }
      const isOpen = elements.openQuestionBtn.classList.contains('active');
      let options = [];
      if (!isOpen) {
        const optionsText = elements.questionOptions.value.trim();
        if (!optionsText) {
          alert('Por favor, adicione op√ß√µes para a pergunta fechada.');
          return;
        }
        options = optionsText.split('\n').map(opt => opt.trim()).filter(opt => opt);
        if (options.length < 2) {
          alert('Adicione pelo menos duas op√ß√µes para a pergunta fechada.');
          return;
        }
      }
      const question = {
        id: Date.now(), text: questionText, type: isOpen ? 'open' : 'closed',
        options: options, responses: [], timestamp: new Date(), isActive: false
      };
      eventData.questions.push(question);
      renderQuestionsList();
      updateStats();
      elements.questionText.value = '';
      elements.questionOptions.value = '';
      if (eventData.questions.length === 1) setActiveQuestion(0);
    }

    function renderQuestionsList() {
      elements.questionsList.innerHTML = '';
      if (eventData.questions.length === 0) {
        elements.questionsList.innerHTML = '<p>Nenhuma pergunta criada ainda.</p>';
        return;
      }
      eventData.questions.forEach((question, index) => {
        const card = document.createElement('div');
        card.className = `question-card ${index === eventData.activeQuestionIndex ? 'active' : ''}`;
        card.setAttribute('role', 'region');
        card.setAttribute('aria-label', `Pergunta ${index + 1}: ${question.text}`);
        const badge = question.type === 'open' ? 
          '<span class="badge badge-open">Aberta</span>' : 
          '<span class="badge badge-closed">Fechada</span>';
        card.innerHTML = `
          <h3> ${question.text} ${badge} </h3>
          <div class="meta"> ${formatTime(question.timestamp)} ‚Ä¢ ${question.responses.length} resposta(s) </div>
          <div class="actions">
            <button class="btn-sm ${index === eventData.activeQuestionIndex ? 'btn-success' : 'btn-outline'}" 
              onclick="setActiveQuestion(${index})" aria-pressed="${index === eventData.activeQuestionIndex ? 'true' : 'false'}">
              ${index === eventData.activeQuestionIndex ? 'Ativa' : 'Ativar'}
            </button>
            <button class="btn-sm btn-danger" onclick="removeQuestion(${index})" aria-label="Remover pergunta">Remover</button>
          </div>`;
        elements.questionsList.appendChild(card);
      });
    }

    function setActiveQuestion(index) {
      if (index < 0 || index >= eventData.questions.length) return;
      if (eventData.activeQuestionIndex !== -1 && eventData.questions[eventData.activeQuestionIndex]) {
        eventData.questions[eventData.activeQuestionIndex].isActive = false;
      }
      eventData.activeQuestionIndex = index;
      if(eventData.questions[index]) eventData.questions[index].isActive = true;
      renderQuestionsList();
      renderActiveQuestion();
      updateNavigationButtons();
    }

    function renderActiveQuestion() {
      if (eventData.activeQuestionIndex === -1 || !eventData.questions[eventData.activeQuestionIndex]) {
        elements.activeQuestionPanel.classList.add('hidden');
        elements.noActiveQuestion.classList.remove('hidden');
        elements.activeQuestionBadge.classList.add('hidden');
        elements.publicQuestion.textContent = 'Aguardando o in√≠cio das perguntas...';
        elements.publicResponses.innerHTML = '<p>Aguardando respostas...</p>';
        return;
      }
      const question = eventData.questions[eventData.activeQuestionIndex];
      elements.activeQuestionPanel.classList.remove('hidden');
      elements.noActiveQuestion.classList.add('hidden');
      elements.activeQuestionBadge.classList.remove('hidden');
      elements.activeQuestionTitle.textContent = `Pergunta ${eventData.activeQuestionIndex + 1} de ${eventData.questions.length}`;
      elements.activeQuestionText.textContent = question.text;
      if (question.type === 'closed') {
        elements.activeQuestionOptions.classList.remove('hidden');
        elements.activeQuestionOptions.innerHTML = '';
        question.options.forEach((option) => {
          const optionBtn = document.createElement('button');
          optionBtn.className = 'btn-sm btn-outline'; // Alterado para melhor contraste e clique
          optionBtn.textContent = option;
          optionBtn.onclick = () => addResponseFromOption(option);
          optionBtn.setAttribute('aria-label', `Adicionar resposta: ${option}`);
          elements.activeQuestionOptions.appendChild(optionBtn);
        });
      } else {
        elements.activeQuestionOptions.classList.add('hidden');
        elements.activeQuestionOptions.innerHTML = ''; // Limpar op√ß√µes anteriores
      }
      renderResponsesList();
      elements.publicQuestion.textContent = question.text;
      renderPublicResponses();
    }

    function addResponse() {
      if (eventData.activeQuestionIndex === -1) { alert('Nenhuma pergunta ativa no momento.'); return; }
      const responseText = elements.responseText.value.trim();
      if (!responseText) { alert('Por favor, digite uma resposta.'); return; }
      const response = { text: responseText, timestamp: new Date() };
      eventData.questions[eventData.activeQuestionIndex].responses.push(response);
      eventData.totalResponses++;
      elements.responseText.value = '';
      renderResponsesList();
      renderPublicResponses();
      updateStats();
    }

    function addResponseFromOption(option) {
      // elements.responseText.value = option; // N√£o precisa preencher o campo de texto
      // addResponse(); // Chama addResponse diretamente com a op√ß√£o
       if (eventData.activeQuestionIndex === -1) { alert('Nenhuma pergunta ativa no momento.'); return; }
      const response = { text: option, timestamp: new Date() };
      eventData.questions[eventData.activeQuestionIndex].responses.push(response);
      eventData.totalResponses++;
      renderResponsesList();
      renderPublicResponses();
      updateStats();
    }

    function renderResponsesList() {
      if (eventData.activeQuestionIndex === -1 || !eventData.questions[eventData.activeQuestionIndex]) {
         elements.responsesList.innerHTML = '<p>Nenhuma resposta recebida ainda.</p>';
         return;
      }
      const responses = eventData.questions[eventData.activeQuestionIndex].responses;
      elements.responsesList.innerHTML = '';
      if (responses.length === 0) {
        elements.responsesList.innerHTML = '<p>Nenhuma resposta recebida ainda.</p>';
        return;
      }
      responses.forEach((response, index) => {
        const card = document.createElement('div');
        card.className = 'response-card';
        card.setAttribute('role', 'region');
        card.setAttribute('aria-label', `Resposta: ${response.text}`);
        card.innerHTML = `
          <div>${response.text}</div>
          <div class="meta">
            <span>${formatTime(response.timestamp)}</span>
            <button class="btn-sm btn-danger" onclick="removeResponse(${index})" aria-label="Remover resposta">Remover</button>
          </div>`;
        elements.responsesList.appendChild(card);
      });
    }

    function renderPublicResponses() {
      if (eventData.activeQuestionIndex === -1 || !eventData.questions[eventData.activeQuestionIndex]) {
        elements.publicResponses.innerHTML = '<p>Aguardando respostas...</p>';
        return;
      }
      const responses = eventData.questions[eventData.activeQuestionIndex].responses;
      elements.publicResponses.innerHTML = '';
      if (responses.length === 0) {
        elements.publicResponses.innerHTML = '<p>Aguardando respostas...</p>';
        return;
      }
      responses.forEach(response => {
        const card = document.createElement('div');
        card.className = 'preview-response';
        card.textContent = response.text;
        elements.publicResponses.appendChild(card);
      });
    }

    function removeQuestion(index) {
      if (confirm('Tem certeza que deseja remover esta pergunta?')) {
        eventData.questions.splice(index, 1);
        if (eventData.activeQuestionIndex === index) {
          eventData.activeQuestionIndex = eventData.questions.length > 0 ? Math.max(0, index -1) : -1;
           if(eventData.questions.length > 0 && eventData.activeQuestionIndex >= eventData.questions.length) {
             eventData.activeQuestionIndex = eventData.questions.length -1;
           }
        } else if (eventData.activeQuestionIndex > index) {
          eventData.activeQuestionIndex--;
        }
        renderQuestionsList();
        setActiveQuestion(eventData.activeQuestionIndex); // Re-set para atualizar tudo
        updateNavigationButtons();
        updateStats();
      }
    }

    function removeResponse(index) {
      if (eventData.activeQuestionIndex === -1) return;
      eventData.questions[eventData.activeQuestionIndex].responses.splice(index, 1);
      eventData.totalResponses--;
      renderResponsesList();
      renderPublicResponses();
      updateStats();
    }

    function navigateToPrevQuestion() {
      if (eventData.activeQuestionIndex > 0) {
        setActiveQuestion(eventData.activeQuestionIndex - 1);
      }
    }

    function navigateToNextQuestion() {
      if (eventData.activeQuestionIndex < eventData.questions.length - 1) {
        setActiveQuestion(eventData.activeQuestionIndex + 1);
      }
    }

    function updateNavigationButtons() {
      elements.prevQuestionBtn.disabled = eventData.activeQuestionIndex <= 0;
      elements.nextQuestionBtn.disabled = eventData.activeQuestionIndex >= eventData.questions.length - 1 || eventData.activeQuestionIndex === -1;
    }

    function registerEmotion(emoji) {
      const emotion = { emoji: emoji, timestamp: new Date() };
      eventData.emotions.push(emotion);
      const emotionBtn = document.querySelector(`.emotion-btn[data-emotion="${emoji}"]`);
      const countElement = emotionBtn.querySelector('.count');
      countElement.textContent = parseInt(countElement.textContent) + 1;
      emotionBtn.classList.add('pulse');
      setTimeout(() => emotionBtn.classList.remove('pulse'), 500); // Dura√ß√£o da anima√ß√£o .pulse
      updateEmotionTimeline();
      updateStats();
      updateCharts();
    }

    function updateEmotionTimeline() {
      elements.emotionTimeline.innerHTML = '';
      if (eventData.emotions.length === 0) {
        elements.emotionTimeline.innerHTML = '<p>Nenhuma emo√ß√£o registrada ainda.</p>';
        return;
      }
      const timelineGroups = {};
      eventData.emotions.forEach(emotion => {
        const timeKey = formatTimeHM(emotion.timestamp);
        if (!timelineGroups[timeKey]) timelineGroups[timeKey] = [];
        timelineGroups[timeKey].push(emotion);
      });
      Object.keys(timelineGroups).sort().forEach(timeKey => {
        const emotions = timelineGroups[timeKey];
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        const emojiCounts = {};
        emotions.forEach(e => { emojiCounts[e.emoji] = (emojiCounts[e.emoji] || 0) + 1; });
        let mostFrequentEmoji = emotions[0].emoji;
        let maxCount = 0;
        Object.keys(emojiCounts).forEach(e => { if (emojiCounts[e] > maxCount) { mostFrequentEmoji = e; maxCount = emojiCounts[e]; } });
        let emojiDisplay = '';
        Object.keys(emojiCounts).forEach(e => { emojiDisplay += `${e} √ó ${emojiCounts[e]} `; });
        timelineItem.innerHTML = `
          <div class="timeline-icon" aria-hidden="true">${mostFrequentEmoji}</div>
          <div class="timeline-content"> <div class="timeline-time">${timeKey}</div> <div>${emojiDisplay.trim()}</div> </div>`;
        elements.emotionTimeline.appendChild(timelineItem);
      });
    }

    function addWordToCloud() {
      const word = elements.wordInput.value.trim().toLowerCase();
      if (!word) { alert('Por favor, digite uma palavra.'); return; }
      const existingWord = eventData.words.find(w => w[0] === word);
      if (existingWord) {
        existingWord[1] += 5; // Incrementa peso da palavra existente
      } else {
        eventData.words.push([word, 10]); // Adiciona nova palavra com peso inicial
      }
      elements.wordInput.value = '';
      renderWordCloud();
      updateStats();
    }

    function clearWordCloud() {
      if (confirm('Tem certeza que deseja limpar a nuvem de palavras?')) {
        eventData.words = [];
        renderWordCloud();
        updateStats();
      }
    }
    
    function initWordCloud() {
      const canvas = elements.wordcloudCanvas;

      // Fun√ß√£o que ajusta o tamanho do canvas considerando devicePixelRatio para melhor nitidez
      const resizeCanvas = () => {
        const container = canvas.parentElement;
        if (!container) return;

        const style = getComputedStyle(container);
        const paddingX = parseFloat(style.paddingLeft) + parseFloat(style.paddingRight);
        const paddingY = parseFloat(style.paddingTop) + parseFloat(style.paddingBottom);

        const width = container.clientWidth - paddingX;
        const height = Math.max(200, container.clientHeight - paddingY);

        // Ajusta para nitidez em telas de alta densidade de pixels
        const dpr = window.devicePixelRatio || 1;
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';

        const ctx = canvas.getContext('2d');
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      };

      // Debounce para evitar renderiza√ß√µes excessivas ao redimensionar
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          resizeCanvas();
          renderWordCloud();
        }, 150);
      });

      resizeCanvas();
      renderWordCloud();
    }

    function renderWordCloud() {
      const canvas = elements.wordcloudCanvas;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (!eventData.words || eventData.words.length === 0) {
        ctx.font = '20px Inter, sans-serif';
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text-muted');
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('Adicione palavras para visualizar a nuvem', canvas.width / 2, canvas.height / 2);
        return;
      }

      const isDarkMode = elements.body.getAttribute('data-theme') === 'dark';
      const isHighContrast = elements.body.getAttribute('data-high-contrast') === 'true';

      let colors = ['#4299e1', '#2b6cb0', '#2c5282', '#2a4365', '#63b3ed', '#90cdf4', '#fefcbf'];
      if (isDarkMode && !isHighContrast) colors = ['#63b3ed', '#90cdf4', '#bee3f8', '#4299e1', '#3182ce', '#2b6cb0', '#fefcbf'];
      if (isHighContrast) colors = ['#000000'];

      WordCloud(canvas, {
        list: eventData.words,
        gridSize: Math.max(4, Math.round(16 * canvas.width / (window.devicePixelRatio * 1024))),
        weightFactor: (size) => Math.pow(size, 1.3) * canvas.width / (window.devicePixelRatio * 512),
        fontFamily: 'Inter, sans-serif',
        color: () => colors[Math.floor(Math.random() * colors.length)],
        backgroundColor: 'transparent',
        rotateRatio: 0.3,
        rotationSteps: 2,
        shape: 'circle',
        drawOutOfBound: false,
        shrinkToFit: true,
        minSize: 5,
      });
    }

    function exportWordCloudAsPNG() {
      if (eventData.words.length === 0) { alert('A nuvem de palavras est√° vazia.'); return; }
      html2canvas(elements.wordcloudCanvas.parentElement).then(canvas => {
        const link = document.createElement('a');
        link.download = `nuvem_palavras_${formatDateFilename(new Date())}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }

    function exportEmotionsAsPNG() {
      if (eventData.emotions.length === 0) { alert('Nenhuma emo√ß√£o registrada ainda.'); return; }
      html2canvas(document.getElementById('emotions-content')).then(canvas => { // Target entire section for context
        const link = document.createElement('a');
        link.download = `emocoes_${formatDateFilename(new Date())}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }

    function exportDashboardAsPNG() {
      html2canvas(document.getElementById('stats-content')).then(canvas => { // Target entire section
        const link = document.createElement('a');
        link.download = `dashboard_${formatDateFilename(new Date())}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }
    
    function initCharts() {
      // Gr√°fico de pizza (doughnut) de emo√ß√µes
      const emotionsCtx = elements.emotionsChartCanvas.getContext('2d');
      emotionsChartInstance = new Chart(emotionsCtx, {
        type: 'doughnut',
        data: {
          labels: [],
          datasets: [{
            data: [],
            backgroundColor: [
              '#4299e1', '#48bb78', '#f6ad55', '#f56565',
              '#9f7aea', '#ed64a6', '#ecc94b', '#38b2ac'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                color: getComputedStyle(elements.body).getPropertyValue('--text-color')
              }
            },
            title: {
              display: true,
              text: 'Distribui√ß√£o de Emo√ß√µes',
              color: getComputedStyle(elements.body).getPropertyValue('--text-color'),
              font: { size: 16 }
            }
          }
        }
      });

      // Inicializa√ß√£o do gr√°fico de linha do tempo (timelineChartInstance)
      const timelineCtx = elements.timelineChartCanvas.getContext('2d');
      timelineChartInstance = new Chart(timelineCtx, {
        type: 'line',
        data: {
          labels: [], // pode ser preenchido dinamicamente depois
          datasets: [
            {
              label: 'Respostas',
              data: [],
              borderColor: '#4299e1',
              backgroundColor: 'rgba(66, 153, 225, 0.2)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Emo√ß√µes',
              data: [],
              borderColor: '#48bb78',
              backgroundColor: 'rgba(72, 187, 120, 0.2)',
              tension: 0.4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: getComputedStyle(elements.body).getPropertyValue('--text-color')
              }
            },
            title: {
              display: true,
              text: 'Intera√ß√µes ao Longo do Tempo',
              color: getComputedStyle(elements.body).getPropertyValue('--text-color'),
              font: { size: 16 }
            }
          },
          scales: {
            x: {
              ticks: {
                color: getComputedStyle(elements.body).getPropertyValue('--text-color')
              },
              grid: {
                color: getComputedStyle(elements.body).getPropertyValue('--border-color')
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(elements.body).getPropertyValue('--text-color')
              },
              grid: {
                color: getComputedStyle(elements.body).getPropertyValue('--border-color')
              }
            }
          }
        }
      });

      updateCharts(); // Popula os gr√°ficos com dados iniciais, se houver
    }

    function updateCharts() {
      // Atualiza gr√°fico de emo√ß√µes
      if (emotionsChartInstance) {
        // Obt√©m cores e atualiza legendas/t√≠tulos para combinar com o tema atual
        const textColor = getComputedStyle(elements.body).getPropertyValue('--text-color');
        emotionsChartInstance.options.plugins.legend.labels.color = textColor;
        emotionsChartInstance.options.plugins.title.color = textColor;

        // Contabiliza quantidade de cada emo√ß√£o (usando emoji como chave)
        const emotionCounts = {};
        if (eventData.emotions && eventData.emotions.length) {
          eventData.emotions.forEach(e => {
            emotionCounts[e.emoji] = (emotionCounts[e.emoji] || 0) + 1;
          });
        }

        // Atualiza labels e dados
        emotionsChartInstance.data.labels = Object.keys(emotionCounts);
        emotionsChartInstance.data.datasets[0].data = Object.values(emotionCounts);

        // Ajusta cores de fundo para a quantidade de emo√ß√µes (mant√©m padr√£o se n√£o precisar)
        const defaultColors = [
          '#4299e1', '#48bb78', '#f6ad55', '#f56565',
          '#9f7aea', '#ed64a6', '#ecc94b', '#38b2ac'
        ];
        emotionsChartInstance.data.datasets[0].backgroundColor = defaultColors.slice(0, Object.keys(emotionCounts).length);

        emotionsChartInstance.update();
      }

      // Atualiza gr√°fico de linha do tempo
      if (timelineChartInstance) {
        const textColor = getComputedStyle(elements.body).getPropertyValue('--text-color');

        // Atualiza cores da legenda e t√≠tulo para o tema atual
        timelineChartInstance.options.plugins.legend.labels.color = textColor;
        timelineChartInstance.options.plugins.title.color = textColor;

        // Atualiza cores dos ticks e grid
        timelineChartInstance.options.scales.x.ticks.color = textColor;
        timelineChartInstance.options.scales.x.grid.color = getComputedStyle(elements.body).getPropertyValue('--border-color');
        timelineChartInstance.options.scales.y.ticks.color = textColor;
        timelineChartInstance.options.scales.y.grid.color = getComputedStyle(elements.body).getPropertyValue('--border-color');

        // Atualiza dados do gr√°fico de linha do tempo com dados de eventData
        // Supondo que eventData tenha propriedades: timelineLabels, timelineResponses, timelineEmotions
        if (eventData.timelineLabels && eventData.timelineResponses && eventData.timelineEmotions) {
          timelineChartInstance.data.labels = eventData.timelineLabels;
          timelineChartInstance.data.datasets[0].data = eventData.timelineResponses;
          timelineChartInstance.data.datasets[1].data = eventData.timelineEmotions;
        } else {
          // Se n√£o houver dados, limpa o gr√°fico
          timelineChartInstance.data.labels = [];
          timelineChartInstance.data.datasets.forEach(dataset => dataset.data = []);
        }

        timelineChartInstance.update();
      }
    }
    
    function startEventTimer() {
        if (eventData.eventTimerInterval) clearInterval(eventData.eventTimerInterval);
        
        function updateDisplay() {
            eventData.eventElapsedTime++;
            const hours = Math.floor(eventData.eventElapsedTime / 3600);
            const minutes = Math.floor((eventData.eventElapsedTime % 3600) / 60);
            const seconds = eventData.eventElapsedTime % 60;
            if (elements.eventTimerDisplay) { // Verifica se o elemento existe
                 elements.eventTimerDisplay.textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
            if (elements.statsTime) { // Verifica se o elemento existe
                elements.statsTime.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            }
        }
        eventData.eventTimerInterval = setInterval(updateDisplay, 1000);
        updateDisplay(); // Chamada inicial
    }

    function updateStats() {
        elements.statsQuestions.textContent = eventData.questions.length;
        elements.statsResponses.textContent = eventData.totalResponses;
        elements.statsEmotions.textContent = eventData.emotions.length;
        elements.statsWords.textContent = eventData.words.length;
        
        // C√°lculo de engajamento (exemplo simples)
        const totalInteractions = eventData.totalResponses + eventData.emotions.length + eventData.words.length;
        // Poderia ser baseado em participantes, se esse dado existisse
        const engagementRate = eventData.questions.length > 0 ? (totalInteractions / (eventData.questions.length * 10)) * 100 : 0; // Exemplo arbitr√°rio
        elements.statsEngagement.textContent = `${Math.min(100, Math.round(engagementRate))}%`;
    }

    // Fun√ß√µes utilit√°rias (stubs, precisam de implementa√ß√£o completa se necess√°rio)
    function formatTime(date) {
      if (!(date instanceof Date)) date = new Date(date);
      return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
    }
    function formatTimeHM(date) { // Formato Hora:Minuto
        if (!(date instanceof Date)) date = new Date(date);
        return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
    }
    function formatDateFilename(date) {
        if (!(date instanceof Date)) date = new Date(date);
        const d = date;
        return `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}_${String(d.getHours()).padStart(2,'0')}${String(d.getMinutes()).padStart(2,'0')}`;
    }
    function exportToCSV() {
        // L√≥gica para gerar e baixar CSV (complexa, depende dos dados a exportar)
        alert('Funcionalidade de exportar para CSV ainda n√£o implementada.');
        console.warn("ExportToCSV function needs implementation.");
    }


    /**
     * Inicializa√ß√£o da aplica√ß√£o
     */
    document.addEventListener('DOMContentLoaded', () => {
      initNavigation(); 
      initQuestionTypeToggle(); 
      initAccessibilityControls(); 
      initEventListeners(); 
      
      initWordCloud(); 
      initCharts(); 
      
      startEventTimer();
      updateStats(); // Atualiza estat√≠sticas iniciais

      // Renderiza√ß√µes iniciais
      renderQuestionsList();
      renderActiveQuestion();
      updateNavigationButtons();
      updateEmotionTimeline();
    });
  </script>
</body>
</html>